<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒ”ã‚¯ãƒ­ã‚¹å•é¡Œã¨ä¸€æ„æ€§ãƒã‚§ãƒƒã‚¯çµæœ</title>
    <style>
        /* --- åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body { 
            font-family: sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            flex-direction: column; 
            margin-top: 30px;
            background-color: #f8f9fa;
        }
        h1 { color: #007bff; margin-bottom: 5px; }
        .result-container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin-top: 20px;
        }
        
        /* --- ä¸€æ„æ€§ãƒã‚§ãƒƒã‚¯çµæœ --- */
        .unicity-box {
            padding: 15px 30px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .unique { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .multiple { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .nosolution { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .error { background-color: #e2e3e5; color: #383d41; border: 1px solid #d6d8db; }

        /* --- ã‚°ãƒªãƒƒãƒ‰ã¨ãƒ’ãƒ³ãƒˆã®é…ç½® --- */
        .nonogram-table {
            display: flex;
        }
        
        /* è§’ã®ç©ºç™½ã‚»ãƒ« */
        .corner-cell {
            /* æœ€å¤§ã®åˆ—ãƒ’ãƒ³ãƒˆã®æ•°ã ã‘é«˜ã•ã‚’ç¢ºä¿ */
            height: 100px; 
            /* æœ€å¤§ã®è¡Œãƒ’ãƒ³ãƒˆã®æ•°ã ã‘å¹…ã‚’ç¢ºä¿ */
            width: 100px; 
            box-sizing: border-box;
        }
        
        /* åˆ—ã®ãƒ’ãƒ³ãƒˆã‚¨ãƒªã‚¢ */
        .col-hints-area {
            display: flex; 
            flex-direction: row;
            border-bottom: 2px solid #333; /* ã‚°ãƒªãƒƒãƒ‰ã¨ã®åŒºåˆ‡ã‚Šç·š */
            padding-bottom: 2px;
        }
        /* è¡Œã®ãƒ’ãƒ³ãƒˆã‚¨ãƒªã‚¢ */
        .row-hints-area {
            border-right: 2px solid #333; /* ã‚°ãƒªãƒƒãƒ‰ã¨ã®åŒºåˆ‡ã‚Šç·š */
            padding-right: 2px;
        }


        /* --- ã‚°ãƒªãƒƒãƒ‰ï¼ˆæœ¬ç›¤é¢ï¼‰ --- */
        table.grid-main { 
            border-collapse: collapse; 
            table-layout: fixed; /* ã‚»ãƒ«ã®å¹…ã‚’å›ºå®š */
        }
        .grid-cell { 
            width: 15px; 
            height: 15px; 
            border: 1px solid #ccc; 
            box-sizing: border-box;
        }
        .black-cell { 
            background-color: black; 
        }
        
        /* --- ãƒ’ãƒ³ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° --- */
        /* åˆ—ãƒ’ãƒ³ãƒˆï¼ˆç¸¦ä¸¦ã³ï¼‰ */
        .col-hint-row {
            display: flex;
            flex-direction: column-reverse; /* ä¸‹ã‹ã‚‰ä¸Šã«è©°ã‚ã‚‹ */
            align-items: center;
            width: 15px; /* ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«ã¨åŒã˜å¹… */
        }
        .col-hint-cell {
            font-size: 10px;
            line-height: 1.2;
            padding: 1px 0;
            height: 15px; /* ç¸¦ã®ãƒ’ãƒ³ãƒˆã‚»ãƒ«ã‚‚ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«ã¨åŒã˜é«˜ã• */
        }
        
        /* è¡Œãƒ’ãƒ³ãƒˆï¼ˆæ¨ªä¸¦ã³ï¼‰ */
        .row-hints { 
            display: flex;
            align-items: center;
            justify-content: flex-end; /* å³å¯„ã› */
            height: 15px; /* ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«ã¨åŒã˜é«˜ã• */
            padding-right: 5px;
        }
        .row-hints span {
            font-size: 10px;
            margin-left: 3px;
            white-space: nowrap;
        }
        
    </style>
</head>
<body>
    <h1>ãƒ”ã‚¯ãƒ­ã‚¹å•é¡ŒãŒå®Œæˆã—ã¾ã—ãŸï¼ ğŸ‰</h1>
    <p>ç”»åƒå‡¦ç†å¾Œã® **{{ width }}x{{ height }}** ã‚°ãƒªãƒƒãƒ‰ã®çµæœã¨ãƒ’ãƒ³ãƒˆã§ã™ã€‚</p>

    <div class="unicity-box 
        {% if unicity == 'Unique' %}unique{% elif unicity == 'Multiple' %}multiple{% elif unicity == 'NoSolution' %}nosolution{% else %}error{% endif %}">
        
        {% if unicity == 'Unique' %}
            âœ… ã“ã®ãƒ’ãƒ³ãƒˆã‚’æŒã¤ãƒ‘ã‚ºãƒ«ã®è§£ã¯**ä¸€æ„**ã§ã™ã€‚
            {% if adaptation_log %}
                <br><small>ï¼ˆ{{ adaptation_log|length }}å›ã®é©å¿œã«ã‚ˆã‚Šä¸€æ„è§£ã‚’é”æˆï¼‰</small>
            {% endif %}
        {% elif unicity == 'Multiple' %}
            âš ï¸ ã“ã®ãƒ’ãƒ³ãƒˆã‚’æŒã¤ãƒ‘ã‚ºãƒ«ã®è§£ã¯**è¤‡æ•°**å­˜åœ¨ã—ã¾ã™ã€‚
        {% elif unicity == 'NoSolution' %}
            âŒ ã“ã®ãƒ’ãƒ³ãƒˆã‚’æŒã¤ãƒ‘ã‚ºãƒ«ã«ã¯**è§£ãŒå­˜åœ¨ã—ã¾ã›ã‚“**ã€‚
        {% elif unicity == 'Error: Sugarã¾ãŸã¯MiniSATãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚PATHã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚' %}
            âš™ï¸ **ã‚¨ãƒ©ãƒ¼:** Sugarã¾ãŸã¯MiniSATãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚
        {% else %}
            âš™ï¸ **ã‚¨ãƒ©ãƒ¼:** åˆ¤å®šä¸èƒ½ ({{ unicity }})
        {% endif %}
    </div>

    <div class="nonogram-table">
        
        <div class="corner-cell"></div>

        <div class="col-hints-area">
            {% for hints in col_hints %}
                <div class="col-hint-row">
                    {% for hint in hints|reverse %} 
                        <span class="col-hint-cell">{{ hint }}</span>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="nonogram-table">
        <div class="row-hints-area">
            <table>
                <tbody>
                    {% for hints in row_hints %}
                        <tr>
                            <td class="row-hints">
                                {% for hint in hints %}
                                    <span>{{ hint }}</span>
                                {% endfor %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <table class="grid-main">
            <tbody>
                {% for y in range(height) %}
                    <tr>
                        {% for x in range(width) %}
                            <td class="grid-cell {% if grid[y][x] == 1 %}black-cell{% endif %}"></td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    {% if adaptation_log %}
    <div style="margin-top: 30px; padding: 20px; background-color: #fff; border-radius: 8px; max-width: 600px;">
        <h3 style="margin-top: 0;">é©å¿œãƒ­ã‚°</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #f0f0f0;">
                    <th style="padding: 8px; border: 1px solid #ddd;">ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</th>
                    <th style="padding: 8px; border: 1px solid #ddd;">ä¸€æ„æ€§</th>
                    <th style="padding: 8px; border: 1px solid #ddd;">é»’ãƒã‚¹æ•°</th>
                </tr>
            </thead>
            <tbody>
                {% for log_entry in adaptation_log %}
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">
                            {% if log_entry.iteration %}{{ log_entry.iteration }}{% else %}-{% endif %}
                        </td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">
                            {% if log_entry.unicity %}
                                <span class="{% if log_entry.unicity == 'Unique' %}unique{% elif log_entry.unicity == 'Multiple' %}multiple{% else %}nosolution{% endif %}" style="padding: 2px 8px; border-radius: 4px; font-size: 0.9em;">
                                    {{ log_entry.unicity }}
                                </span>
                            {% elif log_entry.error %}
                                <span style="color: red;">{{ log_entry.error }}</span>
                            {% elif log_entry.warning %}
                                <span style="color: orange;">{{ log_entry.warning }}</span>
                            {% else %}-{% endif %}
                        </td>
                        <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">
                            {% if log_entry.black_cells %}{{ log_entry.black_cells }}{% else %}-{% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <hr>
    <a href="/">â†©ï¸ åˆ¥ã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹</a>

</body>
</html>